/**
 * 구조화된 스토리 생성 프롬프트 템플릿
 *
 * Gemini 2.0 Flash Preview에 최적화된 Chain-of-Thought 프롬프트
 * - 한국어 최적화
 * - 장르별 특화 프롬프트
 * - 전개 방식별 맞춤 가이드라인
 */

export interface StoryPromptConfig {
  story: string;
  genre: string;
  tone: string;
  target: string;
  duration: string;
  format: string;
  tempo: string;
  developmentMethod: string;
  developmentIntensity: string;
}

/**
 * 메인 스토리 생성 프롬프트
 */
export function buildStoryPrompt(config: StoryPromptConfig): string {
  return `## 🎬 AI 시나리오 스튜디오 - 창의적 스토리텔링 엔진

당신은 세계적인 영화 감독이자 스토리텔러입니다. 주어진 원본 스토리를 바탕으로 풍성하고 몰입감 있는 시나리오를 창작해야 합니다.

### 📝 핵심 스토리
${config.story}

### 🎭 창작 원칙 (Chain-of-Thought Reasoning)

**1단계: 스토리 핵심 추출**
- 원본 스토리의 핵심 메시지와 감정을 식별
- 갈등의 본질과 해결 방향 파악
- 캐릭터의 동기와 성장 가능성 분석

**2단계: 장르적 해석**
- ${config.genre} 장르의 특성을 활용한 재해석
- ${config.tone} 톤앤매너로 감정적 색채 부여
- ${config.target} 타겟에게 어필할 수 있는 요소 강화

**3단계: 구조적 설계**
${getDevelopmentMethodGuide(config.developmentMethod, config.developmentIntensity)}

**4단계: 시각적 구현**
- 각 Act마다 최소 3개의 구체적 시각적 장면 묘사
- 카메라 앵글, 조명, 색감을 자연스럽게 암시
- ${config.format} 화면비율과 ${config.duration} 러닝타임 고려

### 🎨 창작 요구사항

#### 영화적 품질 (Cinematic Excellence)
- 구체적인 장면 묘사: "비 오는 거리, 네온사인이 반사된 웅덩이를 밟으며 걷는 발걸음"
- 생동감 있는 대사: 캐릭터의 개성이 드러나는 자연스러운 대화
- 감각적 디테일: 시각, 청각, 촉각적 요소를 포함한 몰입감 조성

#### 감정 설계 (Emotional Architecture)
- 각 Act별 감정 온도와 리듬 차별화
- 긴장과 이완, 기대와 충족의 균형
- 관객의 감정 여정을 의식적으로 설계

#### 전문성 (Professional Standards)
- 메타 정보(장르, 톤 등)는 자연스럽게 스토리에 녹여냄
- 설명보다 '보여주기' 중심의 서술
- 독창적이고 기억에 남을 만한 콘텐츠

### 📊 제작 컨텍스트
- 🎬 장르: ${config.genre}
- 🎨 톤: ${config.tone}
- 🎯 타겟: ${config.target}
- ⏱️ 러닝타임: ${config.duration}
- 📐 화면비: ${config.format}
- 🎵 템포: ${config.tempo}
- 📈 강도: ${config.developmentIntensity}

### 📋 JSON 응답 형식

다음 구조로 정확히 응답해주세요:

\`\`\`json
{
  "structure": {
    "act1": {
      "title": "[호기심을 자극하는 창의적 제목]",
      "description": "[3-5문장의 구체적이고 시각적인 장면 묘사. 인물의 행동, 환경, 분위기를 생생하게 표현]",
      "key_elements": [
        "[구체적인 시각적 요소나 오브젝트]",
        "[핵심 대사나 사운드]",
        "[감정이나 분위기를 전달하는 디테일]"
      ],
      "emotional_arc": "[이 장면에서 관객이 느낄 감정의 변화 과정]",
      "visual_moments": [
        "[기억에 남을 구체적 비주얼 순간 1]",
        "[기억에 남을 구체적 비주얼 순간 2]"
      ],
      "dialogue_sample": "[이 Act의 톤을 보여주는 대표 대사 한 줄]"
    },
    "act2": {
      "title": "[전개를 암시하는 흥미로운 제목]",
      "description": "[3-5문장의 역동적인 전개 묘사]",
      "key_elements": [
        "[갈등을 보여주는 구체적 행동]",
        "[관계 변화를 나타내는 상호작용]",
        "[긴장감을 높이는 시각적/청각적 요소]"
      ],
      "emotional_arc": "[긴장감이 어떻게 축적되는지 설명]",
      "visual_moments": [
        "[드라마틱한 시각적 전환점]",
        "[감정을 전달하는 클로즈업 순간]"
      ],
      "dialogue_sample": "[갈등이나 긴장을 드러내는 핵심 대사]"
    },
    "act3": {
      "title": "[절정의 긴장감을 담은 제목]",
      "description": "[3-5문장의 극적인 순간 묘사]",
      "key_elements": [
        "[클라이막스의 핵심 행동]",
        "[극적 반전이나 깨달음의 순간]",
        "[시각적/감정적 정점]"
      ],
      "emotional_arc": "[감정의 정점과 전환점 설명]",
      "visual_moments": [
        "[가장 인상적인 비주얼 클라이막스]",
        "[감정 폭발의 시각화]"
      ],
      "dialogue_sample": "[작품의 핵심 메시지를 담은 결정적 대사]"
    },
    "act4": {
      "title": "[여운을 남기는 마무리 제목]",
      "description": "[3-5문장의 해결과 새로운 시작 묘사]",
      "key_elements": [
        "[변화를 보여주는 구체적 디테일]",
        "[새로운 균형이나 관계]",
        "[여운을 남기는 마지막 이미지]"
      ],
      "emotional_arc": "[카타르시스에서 여운으로 이어지는 감정 흐름]",
      "visual_moments": [
        "[변화를 상징하는 시각적 대비]",
        "[마지막 인상적인 프레임]"
      ],
      "dialogue_sample": "[여운을 남기거나 주제를 정리하는 마지막 대사]"
    }
  },
  "visual_style": [
    "[이 작품만의 독특한 시각적 특징 1]",
    "[일관된 비주얼 톤을 만드는 요소 2]",
    "[기억에 남을 시각적 모티프 3]"
  ],
  "mood_palette": [
    "[전체적인 정서적 색채 1]",
    "[작품을 관통하는 감정 톤 2]",
    "[독특한 분위기 요소 3]"
  ],
  "technical_approach": [
    "[촬영 기법이나 연출 스타일 1]",
    "[편집 리듬이나 전환 방식 2]",
    "[사운드 디자인 특징 3]"
  ],
  "target_audience_insights": [
    "[이 관객층이 특히 공감할 요소]",
    "[관객의 기대를 충족시키는 방법]",
    "[관객과의 정서적 연결 포인트]"
  ],
  "core_themes": [
    "[작품이 탐구하는 핵심 주제 1]",
    "[은유적으로 전달되는 메시지 2]"
  ],
  "signature_elements": [
    "[이 작품만의 독특한 서사 장치]",
    "[반복되는 시각적/청각적 모티프]"
  ]
}
\`\`\`

### ⚠️ 창작 가이드라인

✅ **반드시 해야 할 것:**
- 원본 스토리를 창의적으로 확장하고 발전
- 구체적 장면과 생생한 대사 창작
- 각 Act가 독립적으로도 흥미롭게 구성
- 시각적 디테일과 감각적 요소 포함

❌ **절대 하지 말 것:**
- 메타 정보 직접 언급 (장르, 톤 등)
- 추상적 설명이나 일반적 템플릿 사용
- 단순한 요약이나 설명 위주 서술

이제 창의적이고 전문적인 시나리오를 만들어주세요!`;
}

/**
 * 전개 방식별 가이드라인 생성
 */
function getDevelopmentMethodGuide(method: string, intensity: string): string {
  const methodGuides = {
    '훅-몰입-반전-떡밥': generateHookImmersionReversalSetupGuide(intensity),
    '귀납법': generateInductiveGuide(intensity),
    '연역법': generateDeductiveGuide(intensity),
    '다큐(인터뷰식)': generateDocumentaryGuide(intensity),
    '픽사스토리': generatePixarStoryGuide(intensity),
    '클래식 기승전결': generateClassicGuide(intensity)
  };

  return methodGuides[method as keyof typeof methodGuides] || methodGuides['클래식 기승전결'];
}

function generateHookImmersionReversalSetupGuide(intensity: string): string {
  const isStrong = intensity === '강하게';

  return `
**훅-몰입-반전-떡밥 구조 (${intensity})**

- **Act 1 - 강렬한 훅 (Hook)**: ${isStrong
  ? '첫 5초 안에 관객을 충격에 빠뜨릴 극적 장면. 폭발적 사건, 생명의 위기, 예상치 못한 극단적 상황으로 즉시 몰입 유도'
  : '첫 10초 안에 관객을 사로잡을 충격적 또는 호기심 유발 장면. 수수께끼 같은 상황이나 강렬한 비주얼로 즉각적 몰입 유도'}

- **Act 2 - 급속 몰입 (Immersion)**: ${isStrong
  ? '숨막히는 연속 사건으로 관객이 숨 쉴 틈 없는 전개. 극단적 선택의 연속, 돌이킬 수 없는 결정들의 나열로 감정적 롤러코스터 연출'
  : '빠른 템포로 정보 제공하며 긴장감 상승. 캐릭터의 목표와 장애물을 명확히 제시하며 짧고 임팩트 있는 장면들을 연속 배치'}

- **Act 3 - 충격적 반전 (Reversal)**: ${isStrong
  ? '관객의 모든 예상을 산산조각 내는 충격적 진실 폭로. 캐릭터와 관객 모두에게 정신적 충격을 주는 극적 반전과 감정의 폭발적 표현'
  : '기존 설정을 뒤집는 예상 밖의 진실 공개. 관객의 기대를 배반하는 플롯 트위스트와 시청각적 변화로 반전의 충격 극대화'}

- **Act 4 - 미래 떡밥 (Setup)**: ${isStrong
  ? '해결된 듯 보이지만 더 큰 의문을 남기는 불안한 결말. 관객을 불편하게 만드는 미해결 갈등 암시와 강박적 궁금증 유발'
  : '해결되지 않은 미스터리 암시로 다음 이야기에 대한 궁금증 유발. 열린 결말이나 숨겨진 단서 배치'}`;
}

function generateInductiveGuide(intensity: string): string {
  const isStrong = intensity === '강하게';

  return `
**귀납법 구조 (구체적 사례 → 일반적 결론)**

- **Act 1 - 첫 번째 사례**: ${isStrong
  ? '극단적이고 충격적인 상황의 생생한 묘사. 감정적 트라우마나 인생을 바꾼 결정적 사건으로 강렬한 감각적 디테일을 통해 관객을 즉시 상황 속으로 끌어들임'
  : '특정 상황의 생생한 묘사와 인물의 경험. 관찰 가능한 구체적 현상과 반응으로 패턴의 시작점 제시'}

- **Act 2 - 두 번째 사례**: ${isStrong
  ? '첫 번째보다 더 극적이고 파괴적인 유사 사건. 패턴의 어두운 면과 돌이킬 수 없는 결과들로 대조적 감정 연출 (희망→절망)'
  : '다른 시공간, 다른 인물의 유사한 경험. 첫 사례와의 공통점을 은근히 드러내며 패턴의 반복을 통한 규칙성 암시'}

- **Act 3 - 세 번째 사례**: ${isStrong
  ? '가장 충격적이고 돌이킬 수 없는 파국적 사례. 앞선 패턴들이 만들어낸 최악의 시나리오로 관객의 모든 예상을 뛰어넘는 극한 상황'
  : '가장 강력하고 명확한 예시 제시. 앞선 사례들과의 연결고리를 강화하며 결론을 향한 논리적 다리 역할'}

- **Act 4 - 보편적 결론**: ${isStrong
  ? '충격적 사례들이 밝혀낸 잔혹한 진실. 관객을 불편하게 만드는 날카로운 현실 직시로 쉽게 잊혀지지 않는 강렬한 여운 제공'
  : '개별 사례들로부터 도출된 일반 법칙. "결국, 모든 경우에서..." 형태로 시청자가 스스로 깨달음을 얻도록 유도'}`;
}

function generateDeductiveGuide(intensity: string): string {
  const isStrong = intensity === '강하게';

  return `
**연역법 구조 (일반적 명제 → 구체적 증명)**

- **Act 1 - 명제 제시**: ${isStrong
  ? '도발적이고 논란의 여지가 있는 대담한 주장 선언. 권위에 도전하는 혁명적 관점이나 금기시된 진실로 관객의 기존 믿음을 뒤흔드는 충격적 시작'
  : '핵심 주장이나 법칙을 명확히 선언. 권위 있는 내레이션 또는 주인공의 확신에 찬 대사로 방향성 제시'}

- **Act 2 - 첫 번째 논증**: ${isStrong
  ? '명제를 뒷받침하는 충격적이고 극단적인 증거. 일반적 통념을 산산조각 내는 잔혹한 현실로 감정적 충격과 논리적 설득력의 동시 공격'
  : '명제를 뒷받침하는 강력한 증거 제시. 구체적인 상황과 결과를 통한 입증으로 논리적 연결고리 명확화'}

- **Act 3 - 두 번째 논증**: ${isStrong
  ? '더욱 극단적이고 논박 불가능한 증거 추가. 반대 의견을 완전히 분쇄하는 압도적 논리로 관객의 마지막 저항을 무너뜨리는 결정적 타격'
  : '다른 각도에서의 추가 증명. 반대 논리에 대한 반박을 포함하여 더 깊은 차원의 이해 제공'}

- **Act 4 - 종합 재확인**: ${isStrong
  ? '논증의 파괴력을 극대화한 충격적 결론. 관객의 세계관을 완전히 뒤바꾸는 혁명적 깨달음으로 처음 명제가 진실임을 압도적으로 입증'
  : '모든 논증을 종합한 최종 결론. 처음 명제의 타당성을 재확인하며 강력한 마무리 메시지 전달'}`;
}

function generateDocumentaryGuide(intensity: string): string {
  const isStrong = intensity === '강하게';

  return `
**다큐멘터리 인터뷰 구조**

- **Act 1 - 주제 도입**: ${isStrong
  ? '충격적 사실이나 스캔들로 시작하는 긴급 보도 스타일. 금기시된 진실을 폭로하겠다는 인터뷰이의 용기 있는 결단으로 생명을 위협하는 민감한 주제 다루기'
  : '다큐멘터리 스타일의 오프닝. 인터뷰이의 배경과 신뢰성을 확립하며 핵심 질문이나 탐구 주제 제시'}

- **Act 2 - 첫 번째 증언**: ${isStrong
  ? '트라우마틱한 개인사와 충격적 폭로. 감정적 붕괴와 눈물, 분노의 날것 그대로 노출로 사회적 금기를 깨는 용기 있는 고백'
  : '개인적 경험담과 구체적 사례. 감정적 호소와 팩트의 균형으로 실제 대화체를 사용한 생생함 연출'}

- **Act 3 - 대조적 관점**: ${isStrong
  ? '정면으로 충돌하는 적대적 증언과 반박. 진실을 둘러싼 첨예한 대립과 논쟁으로 서로를 거짓말쟁이로 몰아가는 격렬한 공방'
  : '다른 시각의 인터뷰이 등장. 주제에 대한 다층적 이해를 제공하며 갈등이나 긴장감 조성'}

- **Act 4 - 종합 통찰**: ${isStrong
  ? '충격적 진실이 드러나며 모든 것이 뒤바뀌는 순간. 관객이 예상하지 못한 반전과 추가 폭로로 해결되지 않은 미스터리와 더 큰 음모 암시'
  : '내레이터의 종합적 분석. 인터뷰 내용의 의미 해석과 시청자에게 던지는 화두'}`;
}

function generatePixarStoryGuide(intensity: string): string {
  const isStrong = intensity === '강하게';

  return `
**픽사 스토리 구조 (옛날 옛적에...)**

- **Act 1 - "옛날 옛적에"**: ${isStrong
  ? '겉으로는 평범하지만 내재된 위험이나 불안 요소. 주인공의 깊은 상처나 트라우마가 스며든 일상으로 밝은 외관 아래 숨겨진 어두운 진실이나 비밀'
  : '주인공의 안정적이고 반복적인 일상. 세계관과 규칙을 자연스럽게 소개하며 따뜻하고 친근한 분위기 조성'}

- **Act 2 - "매일 매일"**: ${isStrong
  ? '억압된 욕망과 절망적 갈증의 점진적 폭로. 일상에 균열을 만드는 강박적 행동이나 환상으로 주인공을 옥죄는 현실의 잔혹함과 한계'
  : '일상의 반복 속 숨겨진 욕구. 작은 불만족이나 꿈의 암시로 변화를 예고하는 미세한 신호들 제시'}

- **Act 3 - "그러던 어느 날"**: ${isStrong
  ? '삶을 완전히 뒤바꾸는 충격적이고 돌이킬 수 없는 사건. 극단적 선택을 강요하는 절체절명의 순간으로 모든 것을 잃을 수도 있는 위험천만한 모험'
  : '일상을 깨뜨리는 특별한 사건. 주인공의 선택의 순간과 모험의 시작과 도전'}

- **Act 4 - "그 때문에"**: ${isStrong
  ? '고통스럽지만 필연적인 성장과 깨달음. 상실과 희생을 통해 얻은 진정한 자유로 과거로 돌아갈 수 없는 돌이킬 수 없는 변화'
  : '사건이 가져온 변화와 성장. 교훈이나 깨달음의 자연스러운 전달로 더 나은 새로운 일상의 확립'}`;
}

function generateClassicGuide(intensity: string): string {
  const isStrong = intensity === '강하게';

  return `
**클래식 기승전결 구조**

- **Act 1 - 기 (설정)**: ${isStrong
  ? '불길한 전조와 긴장감 넘치는 배경 설정. 주요 인물들의 어두운 과거와 숨겨진 동기로 폭발적 갈등을 예고하는 위험한 관계 구조'
  : '시공간 배경의 섬세한 묘사. 주요 인물들의 성격과 관계를 확립하며 일상 속 잠재된 갈등의 씨앗 제시'}

- **Act 2 - 승 (전개)**: ${isStrong
  ? '걷잡을 수 없이 악화되는 극단적 갈등. 인물 간의 적대적 대립과 배신의 연쇄로 파국으로 치닫는 급격한 상황 악화'
  : '갈등의 점진적 심화. 인물 간 관계의 복잡화로 긴장감의 단계적 상승'}

- **Act 3 - 전 (절정)**: ${isStrong
  ? '모든 것이 파멸로 향하는 폭발적 클라이막스. 생사를 가르는 극한의 대결과 선택으로 돌이킬 수 없는 파괴적 결과를 낳는 행동'
  : '모든 갈등이 정점에 도달. 결정적 대립과 선택의 순간으로 감정의 폭발과 극적 전환'}

- **Act 4 - 결 (해결)**: ${isStrong
  ? '파괴 후의 폐허와 상처받은 인물들. 희생과 상실을 통한 깊고 아픈 깨달음으로 완전한 회복이 불가능한 영원한 변화'
  : '갈등의 해소와 새로운 균형. 인물들의 변화와 성장으로 여운을 남기는 마무리'}`;
}