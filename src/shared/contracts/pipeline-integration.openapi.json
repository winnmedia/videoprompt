{
  "openapi": "3.0.3",
  "info": {
    "title": "VideoPlanet Pipeline Integration API",
    "description": "시나리오→프롬프트→영상 통합 파이프라인 API\n\nBenjamin's Contract-First Architecture:\n- 모든 DTO는 OpenAPI로 정의\n- Consumer-Driven Contract (CDC) 검증\n- 런타임 Zod 스키마 검증\n- 계약 위반 시 컴파일/테스트 실패",
    "version": "1.0.0",
    "contact": {
      "name": "Backend Lead Benjamin",
      "email": "backend@videoplanet.dev"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "https://videoplanet.vercel.app/api",
      "description": "Production server"
    },
    {
      "url": "http://localhost:3000/api",
      "description": "Development server"
    }
  ],
  "paths": {
    "/pipeline/story": {
      "post": {
        "summary": "1단계: 스토리 입력 및 저장",
        "description": "파이프라인의 첫 번째 단계로 사용자가 입력한 스토리를 검증하고 저장합니다.",
        "operationId": "submitStory",
        "tags": ["Pipeline"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StoryInputRequest"
              },
              "examples": {
                "fantasy_story": {
                  "summary": "판타지 모험 스토리",
                  "value": {
                    "projectId": "550e8400-e29b-41d4-a716-446655440000",
                    "correlationId": "550e8400-e29b-41d4-a716-446655440001",
                    "metadata": {
                      "createdAt": "2024-01-15T10:30:00Z",
                      "version": "1.0.0",
                      "source": "pipeline-integration"
                    },
                    "story": {
                      "content": "한 소년이 마법의 세계로 떠나는 모험 이야기입니다. 그는 용기와 지혜로 시련을 극복하고 성장하게 됩니다.",
                      "title": "마법 세계의 모험",
                      "genre": "Fantasy",
                      "tone": "Adventurous",
                      "targetAudience": "Young Adults"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "스토리 저장 성공",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StoryOutputResponse"
                },
                "examples": {
                  "success": {
                    "summary": "성공적인 스토리 저장",
                    "value": {
                      "success": true,
                      "data": {
                        "storyId": "550e8400-e29b-41d4-a716-446655440002",
                        "content": "한 소년이 마법의 세계로 떠나는 모험 이야기입니다.",
                        "title": "마법 세계의 모험",
                        "processedAt": "2024-01-15T10:31:00Z",
                        "nextStep": "scenario"
                      },
                      "correlationId": "550e8400-e29b-41d4-a716-446655440001"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "500": {
            "$ref": "#/components/responses/ServerError"
          }
        }
      }
    },
    "/pipeline/scenario": {
      "post": {
        "summary": "2단계: 시나리오 생성",
        "description": "스토리를 기반으로 시나리오를 생성합니다.",
        "operationId": "generateScenario",
        "tags": ["Pipeline"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ScenarioGenerationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "시나리오 생성 성공",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ScenarioGenerationResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/ServerError"
          }
        }
      }
    },
    "/pipeline/prompt": {
      "post": {
        "summary": "3단계: 프롬프트 생성",
        "description": "시나리오를 기반으로 영상 생성용 프롬프트를 생성합니다.",
        "operationId": "generatePrompt",
        "tags": ["Pipeline"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PromptGenerationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "프롬프트 생성 성공",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PromptGenerationResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/ServerError"
          }
        }
      }
    },
    "/pipeline/video": {
      "post": {
        "summary": "4단계: 영상 생성",
        "description": "프롬프트를 기반으로 영상을 생성합니다.",
        "operationId": "generateVideo",
        "tags": ["Pipeline"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VideoGenerationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "영상 생성 요청 성공",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/VideoGenerationResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/ServerError"
          }
        }
      }
    },
    "/pipeline/status/{projectId}": {
      "get": {
        "summary": "파이프라인 상태 조회",
        "description": "프로젝트의 파이프라인 진행 상태를 조회합니다.",
        "operationId": "getPipelineStatus",
        "tags": ["Pipeline"],
        "parameters": [
          {
            "name": "projectId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "프로젝트 ID"
          },
          {
            "name": "correlationId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "상관관계 ID (선택적)"
          }
        ],
        "responses": {
          "200": {
            "description": "파이프라인 상태 조회 성공",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PipelineStatusResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/ServerError"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "BasePipelinePayload": {
        "type": "object",
        "required": ["projectId", "correlationId", "metadata"],
        "properties": {
          "projectId": {
            "type": "string",
            "format": "uuid",
            "description": "프로젝트 고유 식별자"
          },
          "userId": {
            "type": "string",
            "description": "사용자 ID (선택적)"
          },
          "correlationId": {
            "type": "string",
            "format": "uuid",
            "description": "요청 추적용 상관관계 ID"
          },
          "metadata": {
            "$ref": "#/components/schemas/PipelineMetadata"
          }
        },
        "additionalProperties": false
      },
      "PipelineMetadata": {
        "type": "object",
        "required": ["createdAt", "version", "source"],
        "properties": {
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "생성 시간"
          },
          "version": {
            "type": "string",
            "enum": ["1.0.0"],
            "description": "API 버전"
          },
          "source": {
            "type": "string",
            "enum": ["pipeline-integration"],
            "description": "요청 소스"
          }
        },
        "additionalProperties": false
      },
      "StoryInputRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BasePipelinePayload"
          },
          {
            "type": "object",
            "required": ["story"],
            "properties": {
              "story": {
                "$ref": "#/components/schemas/StoryData"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "StoryData": {
        "type": "object",
        "required": ["content", "title"],
        "properties": {
          "content": {
            "type": "string",
            "minLength": 10,
            "maxLength": 2000,
            "description": "스토리 내용"
          },
          "title": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "스토리 제목"
          },
          "genre": {
            "type": "string",
            "description": "장르 (선택적)"
          },
          "tone": {
            "type": "string",
            "description": "톤 (선택적)"
          },
          "targetAudience": {
            "type": "string",
            "description": "타겟 관객 (선택적)"
          }
        },
        "additionalProperties": false
      },
      "StoryOutputResponse": {
        "type": "object",
        "required": ["success", "correlationId"],
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "required": ["storyId", "content", "title", "processedAt", "nextStep"],
            "properties": {
              "storyId": {
                "type": "string",
                "format": "uuid"
              },
              "content": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "processedAt": {
                "type": "string",
                "format": "date-time"
              },
              "nextStep": {
                "type": "string",
                "enum": ["scenario"]
              }
            },
            "additionalProperties": false
          },
          "error": {
            "type": "string"
          },
          "correlationId": {
            "type": "string",
            "format": "uuid"
          }
        },
        "additionalProperties": false
      },
      "ScenarioGenerationRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BasePipelinePayload"
          },
          {
            "type": "object",
            "required": ["storyId", "scenario"],
            "properties": {
              "storyId": {
                "type": "string",
                "format": "uuid",
                "description": "참조할 스토리 ID"
              },
              "scenario": {
                "$ref": "#/components/schemas/ScenarioData"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "ScenarioData": {
        "type": "object",
        "required": ["genre", "tone", "structure", "target"],
        "properties": {
          "genre": {
            "type": "string",
            "minLength": 1,
            "description": "시나리오 장르"
          },
          "tone": {
            "type": "string",
            "minLength": 1,
            "description": "시나리오 톤"
          },
          "structure": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "description": "시나리오 구조"
          },
          "target": {
            "type": "string",
            "minLength": 1,
            "description": "타겟 관객"
          },
          "developmentMethod": {
            "type": "string",
            "description": "개발 방법론 (선택적)"
          },
          "developmentIntensity": {
            "type": "string",
            "enum": ["low", "medium", "high"],
            "description": "개발 강도 (선택적)"
          }
        },
        "additionalProperties": false
      },
      "ScenarioGenerationResponse": {
        "type": "object",
        "required": ["success", "correlationId"],
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "required": ["scenarioId", "storyId", "generatedScenario", "structure", "metadata", "processedAt", "nextStep"],
            "properties": {
              "scenarioId": {
                "type": "string",
                "format": "uuid"
              },
              "storyId": {
                "type": "string",
                "format": "uuid"
              },
              "generatedScenario": {
                "type": "string",
                "minLength": 50
              },
              "structure": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "metadata": {
                "type": "object",
                "required": ["genre", "tone", "estimatedDuration"],
                "properties": {
                  "genre": {
                    "type": "string"
                  },
                  "tone": {
                    "type": "string"
                  },
                  "estimatedDuration": {
                    "type": "integer",
                    "minimum": 10,
                    "maximum": 600
                  }
                },
                "additionalProperties": false
              },
              "processedAt": {
                "type": "string",
                "format": "date-time"
              },
              "nextStep": {
                "type": "string",
                "enum": ["prompt"]
              }
            },
            "additionalProperties": false
          },
          "error": {
            "type": "string"
          },
          "correlationId": {
            "type": "string",
            "format": "uuid"
          }
        },
        "additionalProperties": false
      },
      "PromptGenerationRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BasePipelinePayload"
          },
          {
            "type": "object",
            "required": ["scenarioId", "prompt"],
            "properties": {
              "scenarioId": {
                "type": "string",
                "format": "uuid",
                "description": "참조할 시나리오 ID"
              },
              "prompt": {
                "$ref": "#/components/schemas/PromptData"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "PromptData": {
        "type": "object",
        "required": ["visualStyle", "mood", "quality"],
        "properties": {
          "visualStyle": {
            "type": "string",
            "minLength": 1,
            "description": "비주얼 스타일"
          },
          "mood": {
            "type": "string",
            "minLength": 1,
            "description": "무드"
          },
          "quality": {
            "type": "string",
            "enum": ["standard", "premium", "cinematic"],
            "description": "품질 수준"
          },
          "directorStyle": {
            "type": "string",
            "description": "감독 스타일 (선택적)"
          },
          "lighting": {
            "type": "string",
            "description": "조명 (선택적)"
          },
          "cameraAngle": {
            "type": "string",
            "description": "카메라 앵글 (선택적)"
          },
          "movement": {
            "type": "string",
            "description": "움직임 (선택적)"
          },
          "keywords": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "maxItems": 20,
            "description": "키워드 (최대 20개)"
          }
        },
        "additionalProperties": false
      },
      "PromptGenerationResponse": {
        "type": "object",
        "required": ["success", "correlationId"],
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "required": ["promptId", "scenarioId", "finalPrompt", "enhancedKeywords", "metadata", "processedAt", "nextStep"],
            "properties": {
              "promptId": {
                "type": "string",
                "format": "uuid"
              },
              "scenarioId": {
                "type": "string",
                "format": "uuid"
              },
              "finalPrompt": {
                "type": "string",
                "minLength": 20
              },
              "negativePrompt": {
                "type": "string"
              },
              "enhancedKeywords": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "metadata": {
                "type": "object",
                "required": ["quality", "estimatedTokens", "optimizationApplied"],
                "properties": {
                  "quality": {
                    "type": "string",
                    "enum": ["standard", "premium", "cinematic"]
                  },
                  "estimatedTokens": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "optimizationApplied": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              },
              "processedAt": {
                "type": "string",
                "format": "date-time"
              },
              "nextStep": {
                "type": "string",
                "enum": ["video"]
              }
            },
            "additionalProperties": false
          },
          "error": {
            "type": "string"
          },
          "correlationId": {
            "type": "string",
            "format": "uuid"
          }
        },
        "additionalProperties": false
      },
      "VideoGenerationRequest": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BasePipelinePayload"
          },
          {
            "type": "object",
            "required": ["promptId", "video"],
            "properties": {
              "promptId": {
                "type": "string",
                "format": "uuid",
                "description": "참조할 프롬프트 ID"
              },
              "video": {
                "$ref": "#/components/schemas/VideoData"
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "VideoData": {
        "type": "object",
        "required": ["duration"],
        "properties": {
          "duration": {
            "type": "integer",
            "minimum": 5,
            "maximum": 180,
            "description": "영상 길이 (초)"
          },
          "aspectRatio": {
            "type": "string",
            "enum": ["16:9", "9:16", "1:1"],
            "default": "16:9",
            "description": "화면 비율"
          },
          "resolution": {
            "type": "string",
            "enum": ["720p", "1080p", "4k"],
            "default": "1080p",
            "description": "해상도"
          },
          "provider": {
            "type": "string",
            "enum": ["seedance", "runway", "stable-video"],
            "default": "seedance",
            "description": "영상 생성 제공업체"
          },
          "priority": {
            "type": "string",
            "enum": ["low", "normal", "high"],
            "default": "normal",
            "description": "처리 우선순위"
          }
        },
        "additionalProperties": false
      },
      "VideoGenerationResponse": {
        "type": "object",
        "required": ["success", "correlationId"],
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "required": ["videoId", "promptId", "jobId", "provider", "status", "processedAt", "nextStep"],
            "properties": {
              "videoId": {
                "type": "string",
                "format": "uuid"
              },
              "promptId": {
                "type": "string",
                "format": "uuid"
              },
              "jobId": {
                "type": "string",
                "minLength": 1
              },
              "provider": {
                "type": "string"
              },
              "status": {
                "type": "string",
                "enum": ["queued", "processing", "completed", "failed"]
              },
              "estimatedCompletionTime": {
                "type": "string",
                "format": "date-time"
              },
              "queuePosition": {
                "type": "integer",
                "minimum": 0
              },
              "processedAt": {
                "type": "string",
                "format": "date-time"
              },
              "nextStep": {
                "type": "null"
              }
            },
            "additionalProperties": false
          },
          "error": {
            "type": "string"
          },
          "correlationId": {
            "type": "string",
            "format": "uuid"
          }
        },
        "additionalProperties": false
      },
      "PipelineStatusResponse": {
        "type": "object",
        "required": ["success"],
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object",
            "required": ["projectId", "currentStep", "status", "progress", "lastUpdated"],
            "properties": {
              "projectId": {
                "type": "string",
                "format": "uuid"
              },
              "currentStep": {
                "type": "string",
                "enum": ["story", "scenario", "prompt", "video"]
              },
              "status": {
                "type": "string",
                "enum": ["idle", "processing", "completed", "failed"]
              },
              "progress": {
                "type": "object",
                "required": ["story", "scenario", "prompt", "video"],
                "properties": {
                  "story": {
                    "type": "object",
                    "required": ["completed"],
                    "properties": {
                      "completed": {
                        "type": "boolean"
                      },
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      }
                    },
                    "additionalProperties": false
                  },
                  "scenario": {
                    "type": "object",
                    "required": ["completed"],
                    "properties": {
                      "completed": {
                        "type": "boolean"
                      },
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      }
                    },
                    "additionalProperties": false
                  },
                  "prompt": {
                    "type": "object",
                    "required": ["completed"],
                    "properties": {
                      "completed": {
                        "type": "boolean"
                      },
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      }
                    },
                    "additionalProperties": false
                  },
                  "video": {
                    "type": "object",
                    "required": ["completed"],
                    "properties": {
                      "completed": {
                        "type": "boolean"
                      },
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "jobId": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              "lastUpdated": {
                "type": "string",
                "format": "date-time"
              },
              "errors": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["step", "message", "timestamp"],
                  "properties": {
                    "step": {
                      "type": "string",
                      "enum": ["story", "scenario", "prompt", "video"]
                    },
                    "message": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  },
                  "additionalProperties": false
                }
              }
            },
            "additionalProperties": false
          },
          "error": {
            "type": "string"
          }
        },
        "additionalProperties": false
      }
    },
    "responses": {
      "ValidationError": {
        "description": "요청 데이터 검증 실패",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean",
                  "example": false
                },
                "error": {
                  "type": "string",
                  "example": "validation error: story.content must be at least 10 characters"
                },
                "details": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "field": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "NotFoundError": {
        "description": "요청한 리소스를 찾을 수 없음",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean",
                  "example": false
                },
                "error": {
                  "type": "string",
                  "example": "Story not found with id: 550e8400-e29b-41d4-a716-446655440002"
                }
              }
            }
          }
        }
      },
      "ServerError": {
        "description": "서버 내부 오류",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean",
                  "example": false
                },
                "error": {
                  "type": "string",
                  "example": "Internal server error"
                },
                "correlationId": {
                  "type": "string",
                  "format": "uuid"
                }
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Pipeline",
      "description": "시나리오→프롬프트→영상 통합 파이프라인 API"
    }
  ]
}