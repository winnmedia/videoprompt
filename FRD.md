# VideoPrompt 서비스 FRD (Functional Requirements Document)

## 📋 프로젝트 개요

**VideoPrompt**는 AI를 활용한 영상 콘텐츠 생성 및 관리 플랫폼으로, 복잡한 설정 없이 3단계만으로 전문가 수준의 영상을 제작할 수 있는 서비스입니다.

## 🎯 핵심 비즈니스 목표

1. **접근성 향상**: 전문 지식 없이도 고품질 영상 제작 가능
2. **효율성 증대**: 3단계 워크플로우로 빠른 콘텐츠 생성
3. **품질 보장**: AI 기반 자동화로 일관된 결과물 제공
4. **통합 관리**: 생성된 콘텐츠의 체계적 관리 및 재사용

## 🏗️ 기술 아키텍처

### 프론트엔드 스택

- **Framework**: Next.js 15.4.6 (App Router)
- **Language**: TypeScript 5.7 (Strict Mode)
- **UI Library**: React 19.1.0
- **Styling**: Tailwind CSS v4 (신규 표준), CSS Modules (레거시)
- **State Management**: Redux Toolkit 2.0 (전역 클라이언트 상태)
- **Architecture**: Feature-Sliced Design (FSD) + Clean Architecture

### 백엔드 및 AI 서비스

- **AI Providers**:
  - Google Gemini (스토리 생성)
  - Seedance/ModelArk (영상 생성)
  - Google Imagen (이미지 생성)
  - Google Veo3 (영상 생성)
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Storage**: Supabase Storage
- **Deployment**: Vercel (Frontend), Supabase (Backend)

### 아키텍처 원칙

#### 2.1 FSD 경계 준수 (Feature-Sliced Design)

- 무엇(What): `shared → entities → features → widgets → app/pages`의 단방향 의존성만 허용하며, 각 슬라이스는 Public API(`index.ts`)를 통해서만 외부 노출
- 왜(Why): 레이어 침식과 순환 의존성을 원천 차단하여 유지보수성과 테스트 용이성 극대화
- 어떻게(How): 깊은 경로 임포트 금지, 배럴→배럴 재수출 금지, Named export 우선, `@/shared/*` 등 경로 별칭 사용, ESLint `import/no-cycle` 상시 점검

#### 2.2 TDD 우선 흐름 (Test-Driven Development)

- 무엇(What): "테스트 작성(실패) → 최소 구현(통과) → 리팩터링" 사이클로 개발, 수용 기준(DoD)을 테스트로 명세 후 개발
- 왜(Why): 요구사항 누락과 회귀 방지, 리팩터링 안전망 제공
- 어떻게(How): 유닛(도메인) → 통합(API/스토리 플로우) → E2E(스모크) 최소 세트 유지, 시간/네트워크 등 비결정성은 테스트 더블로 격리(MSW, Zod)

#### 2.3 클린 임포트 및 중복 제로(DRY)

- 무엇(What): 동일 목적 코드/스타일/유틸은 하나의 모듈로 추상화, 사이드 이펙트 임포트 최소화
- 왜(Why): 중복과 은닉 의존성은 리팩터링 비용 급증 유발
- 어떻게(How): `import type` 구분, 임포트 정렬(외부→내부→상대), 순환 차단, 클라이언트/서버 경계 준수, 린트/CI 강제

## ⚡ 주요 기능 요구사항

### 글로벌 헤더 & 브랜딩

- **좌상단 로고**: `/w_logo.svg`(흰색 텍스트 VLANET 로고)를 사용하며, 헤더 바의 세로 높이에 맞춰 자동 맞춤(높이 100% 유지, 종횡비 보존). 로고 옆의 텍스트 라벨 `vlanet`는 표시하지 않음.
- **명도 대비**: 다크 테마에서도 충분한 대비 확보(배경 `surface` 톤 대비 4.5:1 이상). 호버/포커스시 아웃라인 표시.
- **네비**: 홈, AI 영상 기획(`/scenario`), 프롬프트 생성기(`/prompt-generator`), 영상 생성(`/workflow`), 영상 피드백(`/feedback`), 콘텐츠 관리(`/planning`).

### 랜딩 페이지 CTA 라우팅

- **무료로 시작하기**: 클릭 시 AI 영상 기획 기능으로 이동 → 라우트 `/scenario`.
- **워크플로우 보기**: 클릭 시 기능 설명 매뉴얼 페이지로 이동 → 라우트 `/manual`.

## 🧪 품질 보증

### 테스트 전략

- **TDD 원칙**: Red → Green → Refactor 사이클
- **테스트 피라미드**: 단위(90%), 컴포넌트/통합(70%), E2E
- **MSW 모킹**: 외부 API 의존성 절단
- **결정론성**: 플래키 테스트 방지

### 품질 게이트

- **타입 안정성**: TypeScript 컴파일 통과
- **코드 품질**: ESLint, Prettier 통과
- **테스트 커버리지**: Jest, Cypress 통과
- **성능 예산**: LCP 2.5초, INP 200ms, CLS 0.1 이하

## 🚀 배포 및 운영

### 자동화된 배포

- **GitHub Actions**: Pull Request마다 Preview 배포
- **Vercel 연동**: main 브랜치 푸시 시 Production 배포
- **환경별 설정**: 개발/프로덕션 환경 자동 감지

### 모니터링 및 알림

- **MCP 서버**: 성능 모니터링 및 알림 서비스
- **에러 추적**: 상세한 에러 로깅 및 분석
- **성능 지표**: 실시간 성능 모니터링

### 관측성 표준(로깅/트레이싱) [추가]

- 구조화 로깅: `timestamp, level, endpoint, provider, jobId|operationId, elapsedMs, retryCount` 포함
- 추적: `traceId/requestId` 전파(응답 헤더, 클라이언트 스토리지 보관 금지), 오류에 `error_code` 태그 부여
- 민감정보(PII) 제외, URL/토큰 마스킹. 샘플링은 에러/슬로우쿼리 우선 수집

### 환경변수 요약 [추가]

- `GOOGLE_GEMINI_API_KEY`: Gemini/Veo/Imagen 호출용 API 키 (필수)
- `IMAGEN_PROVIDER`, `IMAGEN_LLM_MODEL`: Imagen Provider/모델 지정
- `VEO_PROVIDER`, `VEO_MODEL`: Veo3 활성화/모델 지정
- `SEEDANCE_API_KEY`, `SEEDANCE_API_BASE`, `SEEDANCE_MODEL`: Seedance/ModelArk 설정
  참고: 세부 가이드는 `ENVIRONMENT_VARIABLES.md` 참조. 프로덕션은 Railway 대시보드에 설정.

## 📋 기능별 상세 명세

### 프롬프트 생성기 (Prompt Generator)

- **위치**: `/prompt-generator`
- **목적**: 체계적인 AI 영상 프롬프트 생성
- **핵심 기능**:
  - 스타일 태그 빌더를 통한 체계적 설정
  - 이미지 업로드 및 참조 관리
  - 동적 타임라인 구성
  - LLM 기반 자동 추천

### 워크플로우 관리

- **위치**: `/workflow`
- **목적**: 3단계 영상 제작 프로세스 관리
- **단계별 구성**:
  1. 기본 설정 및 스타일 선택
  2. 장면 요소 및 캐릭터 정의
  3. 타임라인 연출 및 최종 생성

### 시나리오 개발 모드

- **위치**: `/scenario`
- **목적**: 체계적인 스토리 개발 및 구조화
- **AI 연동**: GPT-4, Gemini를 활용한 스토리 생성
- **출력물**: 4단계 구조, 12개 숏트, 콘티 이미지

### 기획안 관리

- **위치**: `/planning`
- **목적**: 생성된 콘텐츠의 통합 관리
- **기능**: 검색, 필터링, 편집, 영상 플레이어

#### 탭 구성 (필수)

- **AI 시나리오**: 제목, 버전, 작성자, 업데이트, 4단계/12숏 여부, PDF 다운로드
- **프롬프트**: 참조 시나리오, 버전, 키워드 수, 타임라인 세그먼트 수, 업데이트
- **이미지**: 타입(콘티/인서트), 태그, 해상도, 업로더, 업로드일
- **영상**: 버전, 길이, 코덱, 상태, 제공자, 참조 프롬프트, 생성시간, 피드백 바로가기

### 워크플로우 매뉴얼 페이지 (Manual) [New]

- **위치**: `/manual`
- **목적**: 신규/기존 사용자가 전 기능을 빠르게 이해·활용하도록 단계별 가이드와 모범 사례 제공
- **레이아웃**: 좌측 고정 목차(섹션 앵커), 우측 본문. 브레드크럼과 상단 검색 입력 제공.
- **콘텐츠 섹션(앵커 포함)**:
cd /home/winnmedia/videoprompt && pnpm exec playwright install --with-deps chromium | cat && PW_BASE_URL=http://localhost:3100 pnpm exec playwright test -g "(header|nav|buttons|usability)" | cat  1. 시작하기: 계정/프로젝트 생성, 전역 테마, 네비 구조
  2. AI 시나리오 개발: 스토리 입력 → 4단계 구성 → 12숏 분해, PDF 내보내기(Marp 명세)
  3. 프롬프트 생성기: 4단계 구성 데이터를 로드해 키워드/타임라인 정제, JSON 출력
  4. 영상 생성: 최신 프롬프트 로드, 제공자(Seedance/Veo3) 선택, 상태 조회
  5. 영상 피드백: 플레이어 툴바(교체/공유/스크린샷/현재시점 코멘트), 버전 스위처와 메타데이터, 코멘트 범위
  6. 콘텐츠 관리: 탭별 기본 컬럼(AI 시나리오/프롬프트/이미지/영상)과 필터 예시
  7. 단축키 & 접근성: T(타임코드), 폼 `id/htmlFor`, `data-testid` 활용 규칙
  8. 트러블슈팅: 업로드 실패 사유, 빌드/테스트 체크리스트
- **요구사항**:
  - 모든 섹션에 고유 앵커 제공(`#getting-started` 등), URL 해시로 직접 링크 가능
  - 본문 내 관련 기능으로의 딥링크 버튼 제공(예: “프롬프트 생성기로 이동” → `/prompt-generator`)
  - 페이지 내 검색(제목/소제목/키워드) 지원, 키보드 포커스 이동 가능
  - CTA “워크플로우 보기”는 이 페이지(`/manual`)로 라우팅

### 관리자 대시보드 (Admin) [New]

- **위치**: `/admin`
- **목적**: 운영/개발자가 백엔드 데이터의 상태를 가시화·점검하고, 문제 상황을 빠르게 진단
- **접근 제어**: 초기에는 로컬/비공개 배포에서만 노출. 프로덕션은 IP/비밀 토큰 보호 예정
- **데이터 소스**: Prisma(PostgreSQL), 백엔드 상태 API(`/api/health`, 외부 제공자 상태)
- **핵심 위젯**:
  1) 사용자(User) 개요: 총계, 최근 7일 증가, 관리자 수, 게스트 비율
  2) 프로젝트/시나리오/프롬프트/영상 메트릭: 총계, 최근 생성 Top 5, 실패/보류 건수
  3) 외부 제공자 상태: Seedance/Veo/Imagen 상태 핑, 평균 지연, 실패율
  4) 큐/잡 상태: 영상 생성 상태 분포(`queued/processing/completed/failed`)
  5) 최근 에러 로그 요약: 에러코드 Top, 최근 20개(PII 제외)
- **테이블 뷰**:
  - Users: id, email/username, role, createdAt, projectsCount(요약)
  - Projects: id, title, status, createdAt, updatedAt, owner
  - Scenarios/Prompts: id, version, updatedAt, owner
  - VideoAssets: id, provider, status, duration, createdAt
- **필터/검색**: 날짜 범위, 상태, 제공자, 키워드 검색
- **액션**(안전모드): 재시도 트리거(영상 상태 `failed` → `queued`), 공유 토큰 만료 처리, 코멘트 삭제(PII/정책 위반)
- **보안/감사**: 상태 변경 액션은 서버 로그에 `admin_action` 이벤트 기록(PII 제외)
- **확장 계획**: RBAC 기반 접근 통제, 감사 로그 상세 뷰, CSV 내보내기

### 영상 기획 (Planning Wizard) [New Feature]

- **역할**: 한 줄 스토리 → 4단계 → 12숏 → 콘티/인서트 → JSON + Marp PDF 자동·반자동 산출
- **위치**: `/planning/create`
- **사용자 여정 (3-Step Wizard)**:
  1. 입력/선택: 제목, 로그라인, 드롭다운(톤앤매너 등), 버튼 그룹(전개 방식), 프리셋 버튼 → [생성] 시 Google Gemini API 호출
  2. 4단계 검토/수정: 4개 카드 인라인 편집 → [숏 생성] 시 12개 숏으로 자동 분해
  3. 12숏 편집·콘티·인서트·내보내기: 3x4 그리드, 좌(콘티 이미지 생성/관리), 우(숏 상세 편집), 인서트 3컷 추천, JSON + Marp PDF 다운로드
- **LLM/편집 규칙**: 전개 강도 반영, 정확히 12숏 분해, 템포별 길이 힌트, 인서트 목적 중복 금지, 콘티 스타일(storyboard pencil sketch, rough, monochrome 등) 지정
- **Marp PDF 명세**: A4 가로, 여백 0, 페이지형 UI, 표지/개요/12숏 상세, 푸터(`VLANET • {프로젝트명} • {p}/{n}`)
- **요구 UI 요소**: 스텝퍼, 입력 폼, 프리셋 버튼, 진행 표시, 카드 에디터, 숏 그리드, 인서트 칩, 내보내기 모달
- **오류 처리**: LLM/이미지 생성 실패·타임아웃 시 해당 카드에 "생성에 실패했습니다." 메시지와 함께 [재시도] 버튼 활성화

### 영상 피드백 (Video Feedback) [New Feature]

- **역할**: 영상 재생 + 타임코드 기반 코멘트 협업(실시간 제외)
- **위치**: `/feedback`
- **레이아웃**: 좌(비디오 플레이어), 우(탭: 코멘트 / 팀원 / 프로젝트 정보)
- **기능 명세**:
  - 코멘트: '코멘트' 용어 표준화, 대댓글, 감정표현 3종, 정렬/필터
  - 팀원/프로젝트 정보: 프로젝트 관리 연동
  - 보조: 타임코드 자동 반영(T 단축키), 스크린샷 파일명 `project-{slug}_TC{mmssfff}_{YYYY-MM-DD}T{HHmmss}.jpg`, 공유 권한·만료 설정
- **요구 UI 요소**: 플레이어 툴바, 코멘트 입력/리스트, 팀원 탭, 프로젝트 정보 탭, 모달(업로드/공유 등)
- **오류 처리**: 업로드 실패 시 원인(파일 크기 초과, 미지원 형식 등) 명확 안내

#### 추가 요구사항 (Controls & Versioning)

- **플레이어 하부 툴바(좌→우)**:
  - 영상 교체(Replace) 버튼: 새로운 파일 업로드 또는 기존 버전 선택으로 교체
  - 영상 공유(Share) 버튼: 링크/권한/만료 설정 포함 공유 모달 호출
  - 스크린샷(Snapshot) 버튼: 현재 프레임 캡처 → 파일명 규칙 적용(`project-{slug}_TC{mmssfff}_{YYYY-MM-DD}T{HHmmss}.jpg`)
  - 현재 시점 피드백(Feedback @TC) 버튼: 현재 타임코드로 코멘트 입력창 포커스 및 자동 채움(T 단축키와 동일 동작)
- **버전 관리(Versioned Player)**:
  - 버전 스위처(UI): v1, v2, v3… 선택 가능, 기본 최신 버전 로드
  - 메타데이터: 각 버전별 업로더, 업로드 시각, 원본 파일명/해시, 길이/코덱 등 저장
  - 코멘트 범위: 기본은 버전 단위로 격리, 옵션으로 "모든 버전 보기" 토글 제공
  - 교체 정책: 새 업로드 시 자동으로 신규 버전 생성(기존 파일은 보존), 되돌리기(Revert)로 과거 버전 활성화 가능

## 🔒 보안 및 권한

### 인증 및 권한

- **API 키 관리**: 환경변수를 통한 안전한 API 키 관리
- **CORS 설정**: 적절한 CORS 헤더로 보안 강화
- **입력 검증**: Zod를 통한 런타임 데이터 검증

#### 계정/인증 전략 [결정]
- **기본**: 게스트 가입/세션(무인증). 이메일·소셜 인증(OAuth/매직링크)은 추후 도입
- **가입**: 별도 폼 없이 첫 진입 시 게스트 계정 생성(브라우저/디바이스 바인딩)
- **로그인/로그아웃**: 로그인 없음. [데이터 초기화] 기능으로 세션 리셋(영구 삭제 경고 표기)
- **데이터 지속성**: 서버에 게스트 `userId` 저장, 장치 간 동기화 없음
- **세션 보안**: HTTP-only Secure 쿠키, SameSite=Lax, 만료 30일(활동 시 갱신)
- **보호 경로**: `/planning`, `/feedback`, `/workflow`, `/scenario` 등은 게스트 세션 보유 시 접근 허용
- **제한**: 팀/공유/프로젝트 초대 등 협업 기능은 비활성화(후속 단계에서 활성화)
- **레이트리밋**: 게스트 단위로 기존 정책 적용(분당 3회, 시간당 10회)
- **업그레이드 경로(추후)**: OAuth 또는 이메일 매직링크로 계정 연결/승격. 자산(프로젝트/미디어/코멘트)은 동일 `userId`로 마이그레이션
- **보안 주의**: CSRF 민감 작업은 SameSite 및 서버 측 Origin/Referrer 검증으로 완화. PII 로깅 금지. 환경변수 Zod 검증 유지

### 데이터 보호

- **파일 업로드**: 안전한 파일 저장 및 접근 제어
- **에러 처리**: 민감한 정보 노출 방지
- **로깅**: PII 정보 제외한 안전한 로깅

### 레이트리밋 및 콘텐츠 안전 정책 [추가]

- 레이트리밋: 사용자/프로젝트 기준 영상 생성 분당 3회, 시간당 10회. 초과 시 `RATE_LIMITED` 반환
- 콘텐츠 안전: 폭력·혐오·개인정보·상표권 침해 프롬프트 차단 또는 리뷰 보류. 차단 시 사용자 피드백과 가이드 제시
- 키 관리: 모든 외부 API 키는 서버 측 환경변수에서만 사용. 클라이언트 노출 금지

## 📈 성능 요구사항

### 응답 시간

- **페이지 로딩**: 3초 이내
- **API 응답**: 8초 이내 (AI 서비스 고려)
- **이미지 업로드**: 10초 이내

### 동시 사용자

- **동시 접속**: 100명 이상 지원
- **동시 생성**: 20개 이상의 동시 영상 생성 지원

### 리트라이/백오프/타임아웃 정책 [추가]

- 네트워크/5xx 오류: 최대 3회 재시도, 고정 2초 지연, 엔드포인트 기본 타임아웃 60초(이미지 120초)
- 4xx 사용자 오류: 재시도 없음(즉시 피드백 및 수정 가이드)
- 타임아웃 시 사용자에게 재시도/배경 처리 안내, 폴백 경로 존재 시 표시(Mock 등)

### 캐싱/프리패치 전략 [추가]

- 상태 조회(`/api/video/status`): `Cache-Control: no-store`(실시간 우선)
- 문서/매뉴얼 페이지: `stale-while-revalidate=60` 적용
- 프리패치: 주요 네비 경로와 최근 작업 상태를 소극적으로 프리패치(사용자 입력 방해 금지)

## 🔄 향후 확장 계획

### 단기 목표 (3개월)

- **AI 모델 확장**: 추가 AI 서비스 통합
- **템플릿 시스템**: 미리 정의된 스타일 템플릿 제공
- **협업 기능**: 팀 기반 프로젝트 관리

### 중기 목표 (6개월)

- **고급 편집 도구**: 기본적인 영상 편집 기능
- **배포 플랫폼**: YouTube, TikTok 등 직접 업로드
- **분석 대시보드**: 콘텐츠 성과 분석

### 장기 목표 (1년)

- **실시간 협업**: 동시 편집 및 실시간 피드백
- **AI 학습**: 사용자 패턴 기반 개인화 추천
- **엔터프라이즈**: 기업용 고급 기능 및 API

---

**문서 버전**: 1.4.0
**최종 업데이트**: 2025-09-20
**작성자**: AI Assistant
**검토자**: 개발팀

### 📝 변경 이력

#### v1.4.0 (2025-09-20)
- **상태 관리**: Zustand → Redux Toolkit 2.0으로 업데이트
- **백엔드 통합**: Railway → Supabase 단일화 완료 반영
- **인증 시스템**: Supabase Auth 추가
- **스토리지**: Supabase Storage 추가
- **환경변수 정리**: Railway 관련 설정 제거

---

> 이 FRD는 VideoPrompt 서비스의 핵심 기능과 요구사항을 체계적으로 정리한 문서입니다. AI 기반 영상 제작의 접근성을 높이고, 전문적인 콘텐츠 생성을 지원하는 것이 주요 목표입니다.
