window.jest_html_reporters_callback__({"numFailedTestSuites":1,"numFailedTests":18,"numPassedTestSuites":0,"numPassedTests":0,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":1,"numTotalTests":18,"startTime":1757693544747,"success":false,"testResults":[{"numFailingTests":18,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1757693547249,"loadTestEnvironmentEnd":1757693544984,"loadTestEnvironmentStart":1757693544949,"runtime":2264,"setupAfterEnvEnd":1757693545184,"setupAfterEnvStart":1757693545161,"setupFilesEnd":1757693545069,"setupFilesStart":1757693544985,"slow":false,"start":1757693544985},"testFilePath":"/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts","failureMessage":"  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › VideoAsset 테이블 › generation_metadata 필드가 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      47 |         \n      48 |         // 현재는 실패할 것 (필드 누락)\n    > 49 |         expect(result.rows).toHaveLength(1);\n         |                             ^\n      50 |         expect(result.rows[0].column_name).toBe('generation_metadata');\n      51 |         expect(result.rows[0].data_type).toBe('jsonb');\n      52 |       });\n\n      at Object.<anonymous> (migration-integrity.test.ts:49:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › VideoAsset 테이블 › quality_score 필드가 존재하고 DECIMAL(3,2) 타입이어야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      63 |         const result = await pgClient.query(query);\n      64 |         \n    > 65 |         expect(result.rows).toHaveLength(1);\n         |                             ^\n      66 |         expect(result.rows[0].data_type).toBe('numeric');\n      67 |         expect(result.rows[0].numeric_precision).toBe(3);\n      68 |         expect(result.rows[0].numeric_scale).toBe(2);\n\n      at Object.<anonymous> (migration-integrity.test.ts:65:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › VideoAsset 테이블 › quality_score 인덱스가 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      81 |         const result = await pgClient.query(query);\n      82 |         \n    > 83 |         expect(result.rows).toHaveLength(1);\n         |                             ^\n      84 |         expect(result.rows[0].indexdef).toContain('quality_score');\n      85 |       });\n      86 |     });\n\n      at Object.<anonymous> (migration-integrity.test.ts:83:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › ShareToken 테이블 › permissions 필드가 존재하고 기본값이 설정되어야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n       98 |         const result = await pgClient.query(query);\n       99 |         \n    > 100 |         expect(result.rows).toHaveLength(1);\n          |                             ^\n      101 |         expect(result.rows[0].data_type).toBe('jsonb');\n      102 |         expect(result.rows[0].column_default).toContain('canView');\n      103 |         expect(result.rows[0].column_default).toContain('canComment');\n\n      at Object.<anonymous> (migration-integrity.test.ts:100:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › Comment 테이블 › comment_type 필드가 존재하고 기본값이 general이어야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      117 |         const result = await pgClient.query(query);\n      118 |         \n    > 119 |         expect(result.rows).toHaveLength(1);\n          |                             ^\n      120 |         expect(result.rows[0].column_default).toContain('general');\n      121 |       });\n      122 |\n\n      at Object.<anonymous> (migration-integrity.test.ts:119:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › Comment 테이블 › comment_type CHECK 제약조건이 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      131 |         const result = await pgClient.query(query);\n      132 |         \n    > 133 |         expect(result.rows).toHaveLength(1);\n          |                             ^\n      134 |         expect(result.rows[0].check_clause).toContain('general');\n      135 |         expect(result.rows[0].check_clause).toContain('technical');\n      136 |         expect(result.rows[0].check_clause).toContain('creative');\n\n      at Object.<anonymous> (migration-integrity.test.ts:133:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › CineGenius v3.1 스키마 계약 검증 › Comment 테이블 › rating 필드 CHECK 제약조건이 1-5 범위여야 함\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      154 |         );\n      155 |         \n    > 156 |         expect(ratingConstraint).toBeDefined();\n          |                                  ^\n      157 |         expect(ratingConstraint.check_clause).toContain('>=');\n      158 |         expect(ratingConstraint.check_clause).toContain('<=');\n      159 |       });\n\n      at Object.<anonymous> (migration-integrity.test.ts:156:34)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › MigrationLog 테이블 존재 검증 › MigrationLog 테이블이 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      173 |       const result = await pgClient.query(query);\n      174 |       \n    > 175 |       expect(result.rows).toHaveLength(1);\n          |                           ^\n      176 |       expect(result.rows[0].table_name).toBe('MigrationLog');\n      177 |     });\n      178 |\n\n      at Object.<anonymous> (migration-integrity.test.ts:175:27)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › MigrationLog 테이블 존재 검증 › MigrationLog 테이블의 필수 필드들이 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      200 |         const result = await pgClient.query(query, [field]);\n      201 |         \n    > 202 |         expect(result.rows).toHaveLength(1);\n          |                             ^\n      203 |         expect(result.rows[0].column_name).toBe(field);\n      204 |       }\n      205 |     });\n\n      at Object.<anonymous> (migration-integrity.test.ts:202:29)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › MigrationLog 테이블 존재 검증 › CineGenius v3.1 마이그레이션 로그가 기록되어야 함\n\n    error: relation \"MigrationLog\" does not exist\n\n      213 |       `;\n      214 |       \n    > 215 |       const result = await pgClient.query(query);\n          |                      ^\n      216 |       \n      217 |       expect(result.rows).toHaveLength(1);\n      218 |       expect(result.rows[0].success).toBe(true);\n\n      at ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17\n      at Object.<anonymous> (migration-integrity.test.ts:215:22)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › Prompt 테이블 인덱스 검증 › cinegenius_version 인덱스가 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      233 |       const result = await pgClient.query(query);\n      234 |       \n    > 235 |       expect(result.rows).toHaveLength(1);\n          |                           ^\n      236 |     });\n      237 |\n      238 |     test('project_id 인덱스가 존재해야 함', async () => {\n\n      at Object.<anonymous> (migration-integrity.test.ts:235:27)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › Prompt 테이블 인덱스 검증 › project_id 인덱스가 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      246 |       const result = await pgClient.query(query);\n      247 |       \n    > 248 |       expect(result.rows).toHaveLength(1);\n          |                           ^\n      249 |     });\n      250 |\n      251 |     test('복합 인덱스 user_id + cinegenius_version이 존재해야 함', async () => {\n\n      at Object.<anonymous> (migration-integrity.test.ts:248:27)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › Prompt 테이블 인덱스 검증 › 복합 인덱스 user_id + cinegenius_version이 존재해야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      259 |       const result = await pgClient.query(query);\n      260 |       \n    > 261 |       expect(result.rows).toHaveLength(1);\n          |                           ^\n      262 |       expect(result.rows[0].indexdef).toContain('user_id');\n      263 |       expect(result.rows[0].indexdef).toContain('cinegenius_version');\n      264 |     });\n\n      at Object.<anonymous> (migration-integrity.test.ts:261:27)\n\n  ● 데이터베이스 마이그레이션 무결성 검증 › 데이터 타입 검증 (Zod 연동) › JSON/JSONB 필드들이 올바른 타입으로 설정되어야 함\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      284 |         const result = await pgClient.query(query, [field.table, field.column]);\n      285 |         \n    > 286 |         expect(result.rows).toHaveLength(1);\n          |                             ^\n      287 |         expect(result.rows[0].data_type).toBe(field.type);\n      288 |       }\n      289 |     });\n\n      at Object.<anonymous> (migration-integrity.test.ts:286:29)\n\n  ● 마이그레이션 롤백 안전성 검증 › 마이그레이션 롤백 후 기존 데이터가 보존되어야 함\n\n    ReferenceError: pgClient is not defined\n\n      310 |       `;\n      311 |       \n    > 312 |       const result = await pgClient.query(query, [table]);\n          |                      ^\n      313 |       \n      314 |       expect(result.rows).toHaveLength(1);\n      315 |       expect(result.rows[0].table_name).toBe(table);\n\n      at Object.<anonymous> (migration-integrity.test.ts:312:22)\n\n  ● 마이그레이션 롤백 안전성 검증 › 외래키 제약조건이 유지되어야 함\n\n    ReferenceError: pgClient is not defined\n\n      325 |     `;\n      326 |     \n    > 327 |     const result = await pgClient.query(query);\n          |                    ^\n      328 |     \n      329 |     // 최소한의 외래키 제약조건이 존재해야 함\n      330 |     expect(result.rows.length).toBeGreaterThan(0);\n\n      at Object.<anonymous> (migration-integrity.test.ts:327:20)\n\n  ● Race Condition 방지 검증 › 마이그레이션 실행 중 중복 실행 방지 메커니즘\n\n    ReferenceError: pgClient is not defined\n\n      351 |     `;\n      352 |     \n    > 353 |     const result = await pgClient.query(query);\n          |                    ^\n      354 |     \n      355 |     expect(result.rows.length).toBeGreaterThan(0);\n      356 |     \n\n      at Object.<anonymous> (migration-integrity.test.ts:353:20)\n\n  ● Race Condition 방지 검증 › 동시 마이그레이션 실행 시 데이터 일관성 보장\n\n    ReferenceError: pgClient is not defined\n\n      370 |     `;\n      371 |     \n    > 372 |     const result = await pgClient.query(query);\n          |                    ^\n      373 |     \n      374 |     expect(result.rows).toHaveLength(1);\n      375 |     // PostgreSQL 기본값은 'read committed'\n\n      at Object.<anonymous> (migration-integrity.test.ts:372:20)\n","testResults":[{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","VideoAsset 테이블"],"duration":105,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:49:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 VideoAsset 테이블 generation_metadata 필드가 존재해야 함","status":"failed","title":"generation_metadata 필드가 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","VideoAsset 테이블"],"duration":99,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:65:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 VideoAsset 테이블 quality_score 필드가 존재하고 DECIMAL(3,2) 타입이어야 함","status":"failed","title":"quality_score 필드가 존재하고 DECIMAL(3,2) 타입이어야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","VideoAsset 테이블"],"duration":99,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:83:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 VideoAsset 테이블 quality_score 인덱스가 존재해야 함","status":"failed","title":"quality_score 인덱스가 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","ShareToken 테이블"],"duration":99,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:100:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 ShareToken 테이블 permissions 필드가 존재하고 기본값이 설정되어야 함","status":"failed","title":"permissions 필드가 존재하고 기본값이 설정되어야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","Comment 테이블"],"duration":100,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:119:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 Comment 테이블 comment_type 필드가 존재하고 기본값이 general이어야 함","status":"failed","title":"comment_type 필드가 존재하고 기본값이 general이어야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","Comment 테이블"],"duration":103,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:133:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 Comment 테이블 comment_type CHECK 제약조건이 존재해야 함","status":"failed","title":"comment_type CHECK 제약조건이 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","CineGenius v3.1 스키마 계약 검증","Comment 테이블"],"duration":102,"failureMessages":["Error: expect(received).toBeDefined()\n\nReceived: undefined\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:156:34)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 CineGenius v3.1 스키마 계약 검증 Comment 테이블 rating 필드 CHECK 제약조건이 1-5 범위여야 함","status":"failed","title":"rating 필드 CHECK 제약조건이 1-5 범위여야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","MigrationLog 테이블 존재 검증"],"duration":97,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:175:27)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 MigrationLog 테이블 존재 검증 MigrationLog 테이블이 존재해야 함","status":"failed","title":"MigrationLog 테이블이 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","MigrationLog 테이블 존재 검증"],"duration":99,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:202:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 MigrationLog 테이블 존재 검증 MigrationLog 테이블의 필수 필드들이 존재해야 함","status":"failed","title":"MigrationLog 테이블의 필수 필드들이 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","MigrationLog 테이블 존재 검증"],"duration":96,"failureMessages":["error: relation \"MigrationLog\" does not exist\n    at /home/winnmedia/videoprompt/node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:215:22)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 MigrationLog 테이블 존재 검증 CineGenius v3.1 마이그레이션 로그가 기록되어야 함","status":"failed","title":"CineGenius v3.1 마이그레이션 로그가 기록되어야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","Prompt 테이블 인덱스 검증"],"duration":95,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:235:27)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 Prompt 테이블 인덱스 검증 cinegenius_version 인덱스가 존재해야 함","status":"failed","title":"cinegenius_version 인덱스가 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","Prompt 테이블 인덱스 검증"],"duration":95,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:248:27)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 Prompt 테이블 인덱스 검증 project_id 인덱스가 존재해야 함","status":"failed","title":"project_id 인덱스가 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","Prompt 테이블 인덱스 검증"],"duration":95,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:261:27)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 Prompt 테이블 인덱스 검증 복합 인덱스 user_id + cinegenius_version이 존재해야 함","status":"failed","title":"복합 인덱스 user_id + cinegenius_version이 존재해야 함"},{"ancestorTitles":["데이터베이스 마이그레이션 무결성 검증","데이터 타입 검증 (Zod 연동)"],"duration":96,"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:286:29)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"데이터베이스 마이그레이션 무결성 검증 데이터 타입 검증 (Zod 연동) JSON/JSONB 필드들이 올바른 타입으로 설정되어야 함","status":"failed","title":"JSON/JSONB 필드들이 올바른 타입으로 설정되어야 함"},{"ancestorTitles":["마이그레이션 롤백 안전성 검증"],"duration":1,"failureMessages":["ReferenceError: pgClient is not defined\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:312:22)\n    at Promise.finally.completed (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)\n    at _callCircusTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:946:3)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)\n    at jestAdapter (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:275:16)\n    at runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:343:7)"],"fullName":"마이그레이션 롤백 안전성 검증 마이그레이션 롤백 후 기존 데이터가 보존되어야 함","status":"failed","title":"마이그레이션 롤백 후 기존 데이터가 보존되어야 함"},{"ancestorTitles":["마이그레이션 롤백 안전성 검증"],"duration":0,"failureMessages":["ReferenceError: pgClient is not defined\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:327:20)\n    at Promise.finally.completed (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)\n    at _callCircusTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:946:3)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)\n    at jestAdapter (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:275:16)\n    at runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:343:7)"],"fullName":"마이그레이션 롤백 안전성 검증 외래키 제약조건이 유지되어야 함","status":"failed","title":"외래키 제약조건이 유지되어야 함"},{"ancestorTitles":["Race Condition 방지 검증"],"duration":0,"failureMessages":["ReferenceError: pgClient is not defined\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:353:20)\n    at Promise.finally.completed (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)\n    at _callCircusTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:946:3)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)\n    at jestAdapter (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:275:16)\n    at runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:343:7)"],"fullName":"Race Condition 방지 검증 마이그레이션 실행 중 중복 실행 방지 메커니즘","status":"failed","title":"마이그레이션 실행 중 중복 실행 방지 메커니즘"},{"ancestorTitles":["Race Condition 방지 검증"],"duration":0,"failureMessages":["ReferenceError: pgClient is not defined\n    at Object.<anonymous> (/home/winnmedia/videoprompt/tests/db/migration-integrity.test.ts:372:20)\n    at Promise.finally.completed (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)\n    at _callCircusTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:946:3)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)\n    at jestAdapter (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-circus@30.1.3/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:275:16)\n    at runTest (/home/winnmedia/videoprompt/node_modules/.pnpm/jest-runner@30.1.3/node_modules/jest-runner/build/index.js:343:7)"],"fullName":"Race Condition 방지 검증 동시 마이그레이션 실행 시 데이터 일관성 보장","status":"failed","title":"동시 마이그레이션 실행 시 데이터 일관성 보장"}]}],"config":{"bail":1,"changedFilesWithAncestor":false,"ci":false,"collectCoverage":false,"collectCoverageFrom":["src/app/api/**/*.ts","src/lib/db/**/*.ts","prisma/**/*.ts","!**/*.d.ts","!**/node_modules/**"],"coverageDirectory":"/home/winnmedia/videoprompt/tests/db/coverage","coverageProvider":"babel","coverageReporters":["json","text","lcov","clover"],"coverageThreshold":{"global":{"branches":70,"functions":70,"lines":70,"statements":70}},"detectLeaks":false,"detectOpenHandles":false,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":false,"json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":1,"noStackTrace":false,"nonFlagArgs":["migration-integrity.test.ts"],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"openHandlesTimeout":1000,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["/home/winnmedia/videoprompt/node_modules/.pnpm/jest-junit@16.0.0/node_modules/jest-junit/index.js",{"outputDirectory":"./test-results/db","outputName":"db-contract-tests.xml","classNameTemplate":"{classname}","titleTemplate":"{title}","ancestorSeparator":" › ","usePathForSuiteName":true}],["/home/winnmedia/videoprompt/node_modules/.pnpm/jest-html-reporters@3.1.7/node_modules/jest-html-reporters/index.js",{"publicPath":"./test-results/db","filename":"db-contract-tests.html","openReport":false,"includeFailureMsg":true,"includeSuiteFailure":true}]],"rootDir":"/home/winnmedia/videoprompt/tests/db","runInBand":false,"runTestsByPath":false,"seed":-2016607461,"skipFilter":false,"snapshotFormat":{"escapeString":false,"printBasicPrototype":false},"testFailureExitCode":1,"testPathPatterns":{"patterns":["migration-integrity.test.ts"],"type":"TestPathPatterns"},"testSequencer":"/home/winnmedia/videoprompt/tests/db/test-sequencer.js","testTimeout":10000,"updateSnapshot":"new","useStderr":false,"verbose":true,"waitForUnhandledRejections":false,"watch":false,"watchAll":false,"watchman":true,"workerThreads":false},"endTime":1757693547255,"_reporterOptions":{"publicPath":"./test-results/db","filename":"db-contract-tests.html","expand":false,"pageTitle":"","hideIcon":false,"testCommand":"","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false,"urlForTestFiles":"","darkTheme":false,"includeConsoleLog":false,"stripSkippedTest":false,"includeFailureMsg":true,"includeSuiteFailure":true},"logInfoMapping":{},"attachInfos":{}})