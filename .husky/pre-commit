#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# $300 ì‚¬ê±´ ë°©ì§€ë¥¼ ìœ„í•œ ì‚¬ì „ ê²€ì‚¬
echo "ğŸ” $300 ì‚¬ê±´ ë°©ì§€ ê²€ì‚¬ ì¤‘..."

# useEffect ì˜ì¡´ì„± ë°°ì—´ì— í•¨ìˆ˜ê°€ ìˆëŠ”ì§€ ê²€ì‚¬
if grep -r "useEffect.*\[.*function\|useEffect.*\[.*=>" src/ --include="*.ts" --include="*.tsx"; then
  echo "ğŸš¨ $300 íŒ¨í„´ ê°ì§€! useEffect ì˜ì¡´ì„± ë°°ì—´ì— í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤."
  echo "ë¹ˆ ë°°ì—´ []ì„ ì‚¬ìš©í•˜ê±°ë‚˜ useCallbackìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë©”ëª¨ì´ì œì´ì…˜í•˜ì„¸ìš”."
  exit 1
fi

# API í˜¸ì¶œì´ ë¬´í•œ ë£¨í”„ì— ë¹ ì§ˆ ìˆ˜ ìˆëŠ” íŒ¨í„´ ê²€ì‚¬
if grep -r "useEffect.*checkAuth\|useEffect.*auth.*me" src/ --include="*.ts" --include="*.tsx"; then
  echo "ğŸš¨ ìœ„í—˜í•œ auth í˜¸ì¶œ íŒ¨í„´ ê°ì§€!"
  echo "auth/me í˜¸ì¶œì€ ì•± ì „ì²´ì—ì„œ 1ë²ˆë§Œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤."
  exit 1
fi

# ESLint ê²€ì‚¬
echo "ğŸ“‹ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ ì¤‘..."
npx eslint . --ext .ts,.tsx --max-warnings 0

# TypeScript íƒ€ì… ê²€ì‚¬
echo "ğŸ”§ íƒ€ì… ê²€ì‚¬ ì¤‘..."
npx tsc --noEmit

echo "âœ… ëª¨ë“  ê²€ì‚¬ í†µê³¼!"