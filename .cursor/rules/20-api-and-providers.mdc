---
globs: src/app/api/**/*.ts,src/lib/providers/**/*.ts
description: API Route/Provider 구현 규칙(Ark v3/Imagen 포함)
---
# API/Provider 구현 규칙

## 공통
- 외부 API 호출: Authorization Bearer + X-Api-Key 병행 가능(환경 의존)
- 타임아웃(>=8s) + 상세 에러 메시지(원인@URL)
- JSON 파싱 실패 대비 `text` 스니펫 안전 반환

## Seedance(Ark v3)
- Base: `SEEDANCE_API_BASE`(기본 `https://ark.ap-southeast.bytepluses.com`)
- Create: POST `/api/v3/contents/generations/tasks`
  - body: `{ model: 'ep-...', content: [{type:'text',text:'… --duration 5 --aspect 16:9'}, (opt) {type:'image_url', image_url:{url}}] }`
- Status: GET `/api/v3/contents/generations/tasks/{id}`
- 서버 라우트:
  - `/api/seedance/create`: 실패도 502/200 중 구분. 본문에 error/raw 포함
  - `/api/seedance/status/[id]`: 항상 200 + `{ ok, status, videoUrl }`
  - `/api/seedance/status-debug/[id]`: headers 미노출, bodySnippet 제한(≤1024)

## Imagen Preview
- JSON/폼/텍스트 입력 허용. 빈 프롬프트는 400
- Google/ModelArk 실패 시 SVG 플레이스홀더 폴백
