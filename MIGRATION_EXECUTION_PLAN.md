# ðŸ“Š VideoPlanet ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ê³„íšì„œ

**Data Lead: Daniel**
**ìƒì„±ì¼ì‹œ**: 2025-09-18
**ë²„ì „**: v1.0

## ðŸŽ¯ ëª©í‘œ

Scenario í…Œì´ë¸”ì— `project_id` í•„ë“œë¥¼ ì•ˆì „í•˜ê²Œ ì¶”ê°€í•˜ì—¬ Project-Scenario ê´€ê³„ë¥¼ í™•ë¦½í•˜ê³ , ë°ì´í„° ë¬´ê²°ì„±ì„ 100% ë³´ìž¥í•˜ëŠ” ê²ƒ

## ðŸ“‹ ì‹¤í–‰ ìˆœì„œ (ë‹¨ê³„ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸)

### âœ… Phase 0: ì‚¬ì „ ì¤€ë¹„ (Pre-flight)
```bash
# 1. í˜„ìž¬ ìƒíƒœ ë°±ì—… ìƒì„±
pg_dump $DATABASE_URL --schema-only > schema_backup_$(date +%Y%m%d_%H%M%S).sql
pg_dump $DATABASE_URL --data-only -t "Scenario" > scenario_data_backup_$(date +%Y%m%d_%H%M%S).sql

# 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
psql $DATABASE_URL -c "SELECT COUNT(*) FROM \"Scenario\";"

# 3. ë””ìŠ¤í¬ ê³µê°„ í™•ì¸ (ë°±ì—… í…Œì´ë¸” ìƒì„±ìš©)
df -h
```

### âœ… Phase 1: ë°ì´í„° ë¬´ê²°ì„± ì‚¬ì „ ê²€ì¦
```bash
# í˜„ìž¬ ë°ì´í„° ìƒíƒœ ê²€ì¦
psql $DATABASE_URL -f scripts/data-integrity-validation.sql
```

**ì²´í¬í¬ì¸íŠ¸**:
- [ ] ëª¨ë“  í•µì‹¬ í…Œì´ë¸” ì¡´ìž¬ í™•ì¸
- [ ] ê¸°ì¡´ ì°¸ì¡° ë¬´ê²°ì„± ì˜¤ë¥˜ ì—†ìŒ
- [ ] Scenario ë ˆì½”ë“œ ê°œìˆ˜ í™•ì¸

### âœ… Phase 2: ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹¤í–‰
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
psql $DATABASE_URL -f prisma/migrations/20250918_add_scenario_project_id.sql
```

**ì²´í¬í¬ì¸íŠ¸**:
- [ ] project_id ì»¬ëŸ¼ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë¨
- [ ] ì™¸ëž˜í‚¤ ì œì•½ì¡°ê±´ ìƒì„± ì™„ë£Œ
- [ ] ì¸ë±ìŠ¤ ìƒì„± ì™„ë£Œ
- [ ] ë°±ì—… í…Œì´ë¸” ìƒì„± ì™„ë£Œ

### âœ… Phase 3: ë°ì´í„° ì—°ê²° ë° ê²€ì¦
```bash
# ë°ì´í„° ì—°ê²° ìƒíƒœ í™•ì¸
psql $DATABASE_URL -c "
SELECT
    COUNT(*) as total_scenarios,
    COUNT(project_id) as linked_scenarios,
    COUNT(*) - COUNT(project_id) as orphaned_scenarios,
    ROUND((COUNT(project_id)::DECIMAL / COUNT(*)::DECIMAL) * 100, 2) as completion_rate
FROM \"Scenario\";
"
```

**ì²´í¬í¬ì¸íŠ¸**:
- [ ] ê¸°ì¡´ Scenario ë ˆì½”ë“œê°€ ì ì ˆí•œ Projectì™€ ì—°ê²°ë¨
- [ ] ì—°ê²° ì™„ì„±ë„ >= 80%
- [ ] ê³ ì•„ ë ˆì½”ë“œ(orphaned) ê°œìˆ˜ í™•ì¸

### âœ… Phase 4: Prisma ìŠ¤í‚¤ë§ˆ ë™ê¸°í™”
```bash
# Prisma ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸
npx prisma db pull
npx prisma generate
```

**ì²´í¬í¬ì¸íŠ¸**:
- [ ] Scenario ëª¨ë¸ì— projectId í•„ë“œ ë°˜ì˜ë¨
- [ ] ê´€ê³„ ì„¤ì • ì •ìƒ ìƒì„±
- [ ] íƒ€ìž… ìƒì„± ì™„ë£Œ

### âœ… Phase 5: ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ í…ŒìŠ¤íŠ¸
```bash
# ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
npm run test:db-connection

# Scenario-Project ê´€ê³„ í…ŒìŠ¤íŠ¸
npm run test:scenario-project-relation
```

**ì²´í¬í¬ì¸íŠ¸**:
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ìž‘ë™
- [ ] Scenario ìƒì„± ì‹œ project_id ì„¤ì •ë¨
- [ ] ê¸°ì¡´ ë°ì´í„° ì¡°íšŒ ì •ìƒ

### âœ… Phase 6: ìµœì¢… ë¬´ê²°ì„± ê²€ì¦
```bash
# ìµœì¢… ë°ì´í„° ê²€ì¦
psql $DATABASE_URL -f scripts/data-integrity-validation.sql
```

**ì²´í¬í¬ì¸íŠ¸**:
- [ ] ëª¨ë“  ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ í†µê³¼
- [ ] ë°ì´í„° í’ˆì§ˆ ê²€ì¦ í†µê³¼
- [ ] ì„±ëŠ¥ ì§€í‘œ ì •ìƒ ë²”ìœ„

## ðŸš¨ ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤

### ë¡¤ë°± ì¡°ê±´
- ë°ì´í„° ì†ì‹¤ ë°œìƒ
- ì°¸ì¡° ë¬´ê²°ì„± ì˜¤ë¥˜ ë°œìƒ
- ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ëŠ¥ ìž¥ì• 
- ì„±ëŠ¥ ì‹¬ê°í•œ ì €í•˜

### ê¸´ê¸‰ ë¡¤ë°± ì‹¤í–‰
```bash
# 1. ì¦‰ì‹œ ë¡¤ë°± (5ë¶„ ì´ë‚´ ì‹¤í–‰ ê°€ëŠ¥)
psql $DATABASE_URL -c "
-- ë°±ì—…ì—ì„œ ë³µì›
TRUNCATE TABLE \"Scenario\";
INSERT INTO \"Scenario\" (id, title, logline, structure4, shots12, pdf_url, version, created_by, created_at, updated_at, user_id)
SELECT id, title, logline, structure4, shots12, pdf_url, version, created_by, created_at, updated_at, user_id
FROM \"Scenario_backup_20250918\";

-- ìŠ¤í‚¤ë§ˆ ë˜ëŒë¦¬ê¸°
ALTER TABLE \"Scenario\" DROP CONSTRAINT IF EXISTS \"Scenario_project_id_fkey\";
ALTER TABLE \"Scenario\" DROP COLUMN IF EXISTS \"project_id\";
"

# 2. Prisma ë™ê¸°í™”
npx prisma db pull
npx prisma generate
```

## ðŸ“Š ì„±ê³µ ê¸°ì¤€ (KPI)

| ì§€í‘œ | ëª©í‘œ | ê²€ì¦ ë°©ë²• |
|-----|------|----------|
| **ë°ì´í„° ë¬´ì†ì‹¤** | 100% | ë°±ì—…ê³¼ í˜„ìž¬ ë°ì´í„° ë¹„êµ |
| **ì°¸ì¡° ë¬´ê²°ì„±** | 0ê±´ ì˜¤ë¥˜ | ë¬´ê²°ì„± ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ |
| **ì—°ê²° ì™„ì„±ë„** | >= 80% | linked_scenarios / total_scenarios |
| **ë‹¤ìš´íƒ€ìž„** | < 30ì´ˆ | ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì‹œê°„ ì¸¡ì • |
| **ë¡¤ë°± ì‹œê°„** | < 5ë¶„ | ê¸´ê¸‰ ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ |

## ðŸ” ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸

### ì‹¤í–‰ ì¤‘ ëª¨ë‹ˆí„°ë§
```bash
# 1. ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
time psql $DATABASE_URL -f prisma/migrations/20250918_add_scenario_project_id.sql

# 2. ë°ì´í„°ë² ì´ìŠ¤ ë½ ëª¨ë‹ˆí„°ë§
psql $DATABASE_URL -c "SELECT * FROM pg_locks WHERE granted = false;"

# 3. ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
watch -n 5 'df -h | grep postgres'
```

### ì‚¬í›„ ëª¨ë‹ˆí„°ë§ (24ì‹œê°„)
- API ì‘ë‹µ ì‹œê°„ ë³€í™”
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì„±ëŠ¥
- ì—ëŸ¬ ë¡œê·¸ ë°œìƒ ë¹ˆë„
- ì‚¬ìš©ìž í™œë™ íŒ¨í„´ ë³€í™”

## ðŸ“ž ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì ˆì°¨

### Level 1: ì¼ë°˜ ì˜¤ë¥˜
- **ë‹´ë‹¹ìž**: Data Lead Daniel
- **ëŒ€ì‘ ì‹œê°„**: 15ë¶„ ì´ë‚´
- **ì ˆì°¨**: ë¡œê·¸ ë¶„ì„ â†’ ìˆ˜ì • â†’ ìž¬ì‹¤í–‰

### Level 2: ë°ì´í„° ë¬´ê²°ì„± ì˜¤ë¥˜
- **ë‹´ë‹¹ìž**: Data Lead + DevOps
- **ëŒ€ì‘ ì‹œê°„**: 5ë¶„ ì´ë‚´
- **ì ˆì°¨**: ì¦‰ì‹œ ë¡¤ë°± â†’ ì›ì¸ ë¶„ì„ â†’ ìˆ˜ì •ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ìž¬ìž‘ì„±

### Level 3: ì‹œìŠ¤í…œ ìž¥ì• 
- **ë‹´ë‹¹ìž**: ì „ì²´ ê°œë°œíŒ€
- **ëŒ€ì‘ ì‹œê°„**: 1ë¶„ ì´ë‚´
- **ì ˆì°¨**: ê¸´ê¸‰ ë¡¤ë°± â†’ ì„œë¹„ìŠ¤ ë³µêµ¬ í™•ì¸ â†’ ì‚¬í›„ ê²€í† 

## ðŸ“… ì‹¤í–‰ íƒ€ì´ë°

### ê¶Œìž¥ ì‹¤í–‰ ì‹œê°„
- **í‰ì¼**: ì˜¤ì „ 10:00 - 11:00 (ê°œë°œíŒ€ í™œë™ ì‹œê°„)
- **ìš”ì¼**: í™”ìš”ì¼ - ëª©ìš”ì¼ (ì£¼ë§ ë©€ë¦¬, ì›”ìš”ì¼ í”¼í•¨)
- **ì¡°ê±´**: ê°œë°œíŒ€ ì „ì› ëŒ€ê¸° ê°€ëŠ¥

### í”¼í•´ì•¼ í•  ì‹œê°„
- ê¸ˆìš”ì¼ ì˜¤í›„ (ì£¼ë§ ëŒ€ì‘ ì–´ë ¤ì›€)
- ì›”ìš”ì¼ ì˜¤ì „ (ë‹¤ë¥¸ ì´ìŠˆ ìš°ì„ ìˆœìœ„)
- ì ì‹¬ì‹œê°„ (12:00-13:00)
- í‡´ê·¼ ì‹œê°„ ì´í›„ (18:00 ì´í›„)

## âœ… ì‹¤í–‰ ì „ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ëª¨ë“  íŒ€ì›ì—ê²Œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ê³µìœ 
- [ ] ë°±ì—… íŒŒì¼ ìƒì„± ë° ê²€ì¦
- [ ] ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ê¶Œí•œ í™•ì¸
- [ ] ëª¨ë‹ˆí„°ë§ ë„êµ¬ ì¤€ë¹„
- [ ] ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì—°ë½ì²˜ í™•ì¸
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ìµœì¢… ê²€í† 
- [ ] ì‹¤í–‰ í™˜ê²½ (ìŠ¤í…Œì´ì§•) í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

**Data Lead Danielì˜ ì„œëª…**: âœ… ë°ì´í„° ë¬´ê²°ì„± ë³´ìž¥
**ê²€í†  ì™„ë£Œ**: 2025-09-18
**ìŠ¹ì¸ ìƒíƒœ**: ì‹¤í–‰ ì¤€ë¹„ ì™„ë£Œ